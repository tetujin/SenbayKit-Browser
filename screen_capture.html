<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <link rel="stylesheet" href="css/jquery-ui.css">
  <script src="js/jquery/jquery-1.12.4.js"></script>
  <script src="js/jquery/jquery-ui.js"></script>

  <script src="js/QR/jsQR.js"></script>

  <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.min.css" rel="stylesheet">

  <title>SenbayKit-Browser | [DEMO] Screen Capture</title>
  <link href="css/card-ui.css" rel="stylesheet">
  <script src="https://cdn.WebRTC-Experiment.com/getScreenId.js"></script>
  <script type="text/javascript" src="js/senbay/BaseX.js" charset="utf-8"></script>
  <script type="text/javascript" src="js/senbay/SenbayFormat.js" charset="utf-8"></script>
  <script type="text/javascript" src="js/senbay/SenbayReader.js" charset="utf-8"></script>
  <script type="text/javascript" src="js/chart/Chart.min.js" charset="utf-8"></script>
  <script type="text/javascript" src="js/senbay/SenbayWidget.js" charset="utf-8"></script>
  <script type="text/javascript" src="js/senbay/SenbayViewer.js" charset="utf-8"></script>

</head>
<body>
  <h1>SenbayKit-Browser | Screen Capture</h1>
  <p>You can capture SenbayVideo on your screen using screen capture function on your browser. The function are supported on <b>Firefox</b> and <b>Google Chrome</b>.</p>
  <h2>Note</h2>
  <p>If you are using <b>Google Chrome</b>, please install an extension for capturing your screen from this link:<a href="https://chrome.google.com/webstore/detail/screen-capturing/ajhifddimkapgcifgcodmmfdlknahffk">https://chrome.google.com/webstore/detail/screen-capturing/ajhifddimkapgcifgcodmmfdlknahffk</a> </p>
  <h2>Dependence</h2>
  The screen capture function is based on Muaz Khan's getScreenId library (MIT License). Please check the following link if you need more detail information. <a href="https://github.com/muaz-khan/getScreenId">https://github.com/muaz-khan/getScreenId</a>
  <h2>Demo</h2>
  <button type="button" name="button" onclick="selectScreen()">select screen</button>

  <button type="button" name="button" onclick="start()">start</button>

  <button type="button" name="button" onclick="stop()">stop</button>

  <br>
  <p>Interval: <input type="text" name="" id="interval" value="100" placeholder="scan interval (default=100ms)"></p>
  <p>Base Number:<input type="text" name="" id="baseNumber" value="122" placeholder="Please input 121 or 122. The default value is 122."></p>
  <div class="container">
  <div id="set">
    <!-- Video Widget -->
    <div class="ui-widget-content ui-widget-video draggable resizable">
      <video id="mv" controls autoplay width="100%"></video>
    </div>
    <!-- Map Widget -->
    <div id="map-widget" class="ui-widget-content ui-widget-map draggable resizable">
      <div id="map"></div>
    </div>

    <!-- Controller Widget -->
    <div class="ui-widget-content ui-widget-controller draggable resizable">
      <h3>Generate a New Chart</h3>
      <input type="button" name="" value="Refresh Valid Keys" onclick="refreshValidKeys()"><br>
      Value-1: <select class="" name="" id="value-1"></select><br>
      Value-2: <select class="" name="" id="value-2"></select><br>
      Value-3: <select class="" name="" id="value-3"></select><br>
      Buffer: <input type="text" name="" value="100" id="bufferValue"><br>
      <button type="button" name="button" onclick="generateChart()">chart</button>
    </div>

    <!-- Raw Data Widget -->
    <div class="ui-widget-content ui-widget-raw draggable resizable">
      <p id="raw"></p>
    </div>

    <!-- Canvas Widget -->
    <div class="ui-widget-content draggable resizable" hidden>
      <canvas id="qr-canvas"></canvas>
    </div>
  </div><!-- End demo -->

  <!-- JavaScript -->
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBmdE_8jjp-eD8p6TI1gpmEU-ycT8VERCQ&callback=initMap"
    async defer></script>

  <script>

    var reader = null;
    $(function() {
      initAll();
      // init reader
    });

    function selectScreen(){
      getScreenId(function (error, sourceId, screen_constraints) {
        navigator.getUserMedia = navigator.mozGetUserMedia || navigator.webkitGetUserMedia;
        navigator.getUserMedia(screen_constraints, function (stream) {
            document.querySelector('video').srcObject = stream
            // console.log(stream);
        }, function (error) {
            console.error(error);
        });
      });
    }

    function start(){
      let baseNumber = Number(document.getElementById("baseNumber").value)
      reader = new SenbayReader('mv',baseNumber);

      // start reader with an observer
      var interval = Number(document.getElementById('interval').value);
      reader.start(interval, function(raw){
        console.log(raw.TIME);
        updateWidgets(raw);
      });
    }

    function stop(){
      reader.stop();
    }

  </script>

</div>


</body>
</html>
